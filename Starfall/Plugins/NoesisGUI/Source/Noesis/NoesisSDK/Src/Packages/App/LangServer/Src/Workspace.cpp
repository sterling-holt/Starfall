////////////////////////////////////////////////////////////////////////////////////////////////////
// NoesisGUI - http://www.noesisengine.com
// Copyright (c) 2013 Noesis Technologies S.L. All Rights Reserved.
////////////////////////////////////////////////////////////////////////////////////////////////////


#include "Workspace.h"
#include "DocumentHelper.h"


////////////////////////////////////////////////////////////////////////////////////////////////////
Noesis::Workspace::Workspace()
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////
bool Noesis::Workspace::IsInitialized() const
{
    return mIsInitialized;
};

////////////////////////////////////////////////////////////////////////////////////////////////////
void Noesis::Workspace::Initialize()
{
    mIsInitialized = true;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
void Noesis::Workspace::Clear()
{
    mIsInitialized = false;
    mDocuments.ClearShrink();
}

////////////////////////////////////////////////////////////////////////////////////////////////////
bool Noesis::Workspace::HasDocument(const Uri& uri)
{
    return mDocuments.Find(uri.Str()) != mDocuments.End();
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Noesis::DocumentContainer& Noesis::Workspace::GetDocument(const Uri& uri)
{
    return mDocuments.Find(uri.Str())->value;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
Noesis::Workspace::DocumentMap& Noesis::Workspace::GetDocuments()
{
    return mDocuments;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
bool Noesis::Workspace::AddDocument(const Uri& uri, const char* vsCodeUri, const char* text,
    const uint32_t version)
{
    const auto it = mDocuments.Find(uri.Str());
    if (it != mDocuments.End())
    {
        return false;
    }
            
    DocumentContainer document{ uri, vsCodeUri, true, 0, text, {},
        version, false };
    DocumentHelper::GenerateLineNumbers(document);
    mDocuments.Insert(uri.Str(), document);
    return true;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
bool Noesis::Workspace::RemoveDocument(const Uri& uri)
{
    const auto it = mDocuments.Find(uri.Str());
    if (it != mDocuments.End()) 
    {
        mDocuments.Erase(it);
        mDocuments.ShrinkToFit();
        return true;
    }
    return false;
}